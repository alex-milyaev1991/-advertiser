import{s as m,a as S}from"./index-CLLq3gts.js";import{d as F,y as s,J as Q,o as h,c as g,l as i,w as n,z as a,L as j,ag as u,a as w,E as U,a1 as E,a0 as B,v as D,_ as O}from"./index-D50FFBti.js";import{s as H}from"./index-BmUwq4vx.js";import{s as z}from"./index-ETHR17tF.js";import{s as P}from"./index-BOBEIKV-.js";import{s as J}from"./index-CCpiHejS.js";import{u as W}from"./creatives-CenJREDn.js";import{u as q}from"./campaigns-DFH-nRZa.js";import"./index-e7WAjRi9.js";import"./index-Cpde-KwR.js";const G={class:"card"},K={class:"flex justify-content-end"},X={class:"preview-container"},Y=["src","onClick"],Z=["src"],ee=["src"],te=F({__name:"CampaignsCreativeAdd",setup(ae){const A=j(),I=s(A.params.id),C=s(),L=q(),p=W(),f=s(p.creatives),M=s({}),d=s({limit:10,totalRecords:0,currentPage:1}),y=s({global:{value:null,matchMode:u.CONTAINS},id:{value:null,matchMode:u.EQUALS},name:{value:null,matchMode:u.CONTAINS},type:{value:null,matchMode:u.EQUALS},moderation_status:{value:null,matchMode:u.EQUALS}}),_=s(!1),c=s(null),N=s([{label:"Video",value:"video"}]),$=s([{label:"Approved",value:"approved"},{label:"Pending",value:"pending"},{label:"Rejected",value:"rejected"}]),V=async()=>{await p.getCreatives(d.value.limit,d.value.currentPage),f.value=p.creatives,d.value.totalRecords=p.pagination.totalRecords,f.value.forEach(o=>{o.type==="video"&&k(o.file_url,t=>{M.value[o.id]=t})})},k=(o,t)=>{const l=document.createElement("video");l.src=o,l.crossOrigin="anonymous",l.addEventListener("loadeddata",()=>{l.currentTime=1}),l.addEventListener("seeked",()=>{const e=document.createElement("canvas");e.width=l.videoWidth,e.height=l.videoHeight;const r=e.getContext("2d");r&&(r.drawImage(l,0,0,e.width,e.height),t(e.toDataURL("image/jpeg")))}),l.load()},x=o=>{d.value.currentPage=Math.floor(o.first/o.rows)+1,d.value.limit=o.rows,V()},b=o=>{c.value=o,_.value=!0},R=o=>{f.value.sort((t,l)=>o.order===1?t.id-l.id:l.id-t.id)},T=()=>{console.log("addCreatives"),L.addCreativesToCampaign(I.value,C.value)};return Q(async()=>{await V()}),(o,t)=>{var l;return h(),g("div",G,[i(a(S),{filters:y.value,"onUpdate:filters":t[1]||(t[1]=e=>y.value=e),value:f.value,tableStyle:"min-width: 50rem",paginator:!0,rows:d.value.limit,totalRecords:d.value.totalRecords,showFilterMatchModes:!1,first:(d.value.currentPage-1)*d.value.limit,onPage:x,filterDisplay:"row"},{header:n(()=>[w("div",K,[i(a(U),{onClick:T},{default:n(()=>t[4]||(t[4]=[E("Add to campaign")])),_:1})])]),default:n(()=>[i(a(m),{field:"id",header:"ID",sortable:"",filter:!0,filterPlaceholder:"Filter by ID",filterMatchMode:a(u).EQUALS,sortFunction:R},null,8,["filterMatchMode"]),i(a(m),{field:"name",header:"Name",filter:!0,filterPlaceholder:"Filter by Name",filterMatchMode:a(u).CONTAINS,showFilterMatchModes:!1},{filter:n(({filterModel:e,filterCallback:r})=>[i(a(z),{modelValue:e.value,"onUpdate:modelValue":v=>e.value=v,type:"text",onInput:v=>r(),placeholder:"Search by name"},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:1},8,["filterMatchMode"]),i(a(m),{header:"Preview"},{body:n(({data:e})=>[w("div",X,[w("img",{src:M.value[e.id],alt:"Preview",class:"thumbnail",onClick:r=>b(e)},null,8,Y),i(a(U),{onClick:r=>b(e),class:"ml-2"},{default:n(()=>t[5]||(t[5]=[E("View")])),_:2},1032,["onClick"])])]),_:1}),i(a(m),{field:"type",header:"Creative Type",filter:!0,filterMatchMode:a(u).EQUALS},{filter:n(({filterModel:e,filterCallback:r})=>[i(a(P),{modelValue:e.value,"onUpdate:modelValue":v=>e.value=v,options:N.value,optionLabel:"label",placeholder:"Select Type","option-value":"value",onChange:v=>r()},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["filterMatchMode"]),i(a(m),{field:"moderation_status",header:"Moderation Status",filter:!0,filterMatchMode:a(u).EQUALS},{filter:n(({filterModel:e,filterCallback:r})=>[i(a(P),{modelValue:e.value,"onUpdate:modelValue":v=>e.value=v,options:$.value,optionLabel:"label","option-value":"value",placeholder:"Select Status",onChange:r},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1},8,["filterMatchMode"]),i(a(m),{header:"Choose"},{body:n(({data:e})=>[i(a(J),{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=r=>C.value=r),inputId:`creative${e.id}`,name:a(S).name,value:e.id},null,8,["modelValue","inputId","name","value"])]),_:1})]),_:1},8,["filters","value","rows","totalRecords","first"]),i(a(H),{visible:_.value,"onUpdate:visible":t[2]||(t[2]=e=>_.value=e),header:(l=c.value)==null?void 0:l.name,style:{width:"50vw"},onHide:t[3]||(t[3]=e=>c.value=null)},{default:n(()=>[c.value?(h(),g(B,{key:0},[c.value.type!="video"?(h(),g("img",{key:0,src:M.value[c.value.id]||c.value.file_url,class:"large-preview"},null,8,Z)):(h(),g("video",{key:1,src:c.value.file_url,controls:""},null,8,ee))],64)):D("",!0)]),_:1},8,["visible","header"])])}}}),me=O(te,[["__scopeId","data-v-1dde7ba4"]]);export{me as default};
